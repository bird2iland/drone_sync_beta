# drone_sync

- 用于基于 DJI SRT 时间戳，在 DaVinci Resolve 中按机位与日期自动生成时间线并导出 XML。
- 核心脚本：`drone_sync_beta.py`。

## 前提条件
- 已安装 `python3`。
- 已启动 DaVinci Resolve 并打开一个项目。
- 素材与 SRT 文件在同一目录，视频扩展名为 `.mp4/.mov`，SRT 文件与视频同名。

## 目录示例
- `-p` 指向的路径下的日期文件夹或直接包含机位文件夹：
- `项目/素材/251114/CAM#1/CARD#A/clip1.MP4 + clip1.SRT`
- `项目/素材/251114/CAM#2/CARD#B/clip3.MP4 + clip3.SRT`

## 使用
- 命令：
- `python3 drone_sync_beta.py -p '<日期文件夹或其上级路径>' -f <帧率> -o '<导出XML目录>'`
- 示例：
- `python3 drone_sync_beta.py -p '/Volumes/DISK_1/素材' -f 50 -o '/Volumes/DISK_1/输出'`

## 交互说明
- 启动后先检测 `-p` 下的结构：
- 若存在机位文件夹（`CAM*`），直接列出供选择；
- 若不存在机位文件夹，则列出其下的日期子文件夹，先选择一个日期文件夹，再列出机位供选择；
- 机位多选输入示例：`1,2,3` 或 `1 2 3`；仅处理所选机位，避免创建无效 Bin/时间线。

## 工作流程
- 忽略隐藏或临时文件（如 `._文件`、以 `.` 开头的文件）。
- 为每个所选机位按拍摄日期分组，在媒体池下创建 `CAMX/YY-MM-DD` 文件夹并导入素材。
- 从 SRT 读取首帧自然时间，计算 `recordFrame`，按顺序追加到对应时间线的视频轨 1。
- 按照素材最高分辨率，设置对应时间线分辨率。
- 时间线命名：`<日期文件夹>_<CAMX>_<YY-MM-DD>`，起始时间码：`00:00:00:00`。

## 输出
- 将所有生成的时间线导出为 `FCP 7 XML`，直接写入 `-o` 指定目录。
- 文件名示例：`251114_CAM#1_25-09-27.xml`。

## 常见问题
- 导出失败：通常因时间线为空或 Resolve 状态问题；请确认存在有效视频与同名 SRT，且已导入到时间线。
- SRT 编码异常：脚本会自动尝试 `utf-8/utf-8-sig/gb18030/latin-1`，极端情况将忽略不可解码字符。
- 只处理所选机位：未选择的机位不会创建任何媒体池文件夹或时间线。